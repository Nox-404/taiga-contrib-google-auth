angular.module("templates").run(["$templateCache",function($templateCache){$templateCache.put("/plugins/google-auth/google-auth.html",'\n<div tg-google-login-button="tg-google-login-button"><a href="" title="Enter with your google account" class="button button-auth"><img src="/plugins/google-auth/images/google-logo.png" alt=""/><span>Sign in with Google</span></a></div>')}]),function(){var GoogleLoginButtonDirective,module;GoogleLoginButtonDirective=function($window,$params,$location,$config,$events,$confirm,$auth,$navUrls,$loader){var link;return link=function($scope,$el,$attrs){var auth_url,clientId,loginOnError,loginOnSuccess,loginWithGoogleAccount;return auth_url="https://accounts.google.com/o/oauth2/auth",clientId=$config.get("googleClientId",null),loginOnSuccess=function(response){var nextUrl;return nextUrl=$params.next&&$params.next!==$navUrls.resolve("login")?$params.next:$navUrls.resolve("home"),$events.setupConnection(),$location.search("next",null),$location.search("token",null),$location.search("state",null),$location.search("code",null),$location.path(nextUrl)},loginOnError=function(response){return $location.search("state",null),$location.search("code",null),$loader.pageLoaded(),response.data._error_message?$confirm.notify("light-error",response.data._error_message):$confirm.notify("light-error","Our Oompa Loompas have not been able to get you credentials from Google.")},loginWithGoogleAccount=function(){var code,data,redirectUri,token,type,url;if(type=$params.state,code=$params.code,token=$params.token,"google"===type&&code)return $loader.start(!0),url=document.createElement("a"),url.href=$location.absUrl(),redirectUri=url.protocol+"//"+url.hostname+(""===url.port?"":":"+url.port)+"/login",data={code:code,token:token,redirectUri:redirectUri},$auth.login(data,type).then(loginOnSuccess,loginOnError)},loginWithGoogleAccount(),$el.on("click",".button-auth",function(event){var redirectToUri,url;return url=document.createElement("a"),url.href=$location.absUrl(),redirectToUri=url.protocol+"//"+url.hostname+(""===url.port?"":":"+url.port)+"/login",url=""+auth_url+"?client_id="+clientId+"&redirect_uri="+redirectToUri+"&state=google&scope=openid%20email&response_type=code",$window.location.href=url}),$scope.$on("$destroy",function(){return $el.off()})},{link:link,restrict:"EA",template:""}},module=angular.module("taigaContrib.googleAuth",[]),module.directive("tggoogleLoginButton",["$window","$routeParams","$tgLocation","$tgConfig","$tgEvents","$tgConfirm","$tgAuth","$tgNavUrls","tgLoader",googleLoginButtonDirective])}.call(this);